<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>在庫管理</title>

<link href="https://fonts.googleapis.com/css2?family=Rounded+Mplus+1c:wght@300;400;500&display=swap" rel="stylesheet">

<style>
body {
  font-family: "Rounded Mplus 1c", sans-serif;
  padding: 20px;
  background: #EFDDD5; /* ベースカラー */
}

h1 {
  color: #482019; /* テキストカラー */
}

/* 追加フォーム */
.add-form {
  background: #F5CFC5;
  border: 1px solid #CF7F72;
  padding: 12px;
  border-radius: 10px;
  margin-bottom: 25px;
}

.add-form label {
  font-size: 14px;
  color: #482019;
}

.add-form select,
.add-form input {
  padding: 6px;
  border-radius: 6px;
  border: 1px solid #CF7F72;
  margin-right: 8px;
  font-size: 14px;
}

.add-form button {
  padding: 6px 12px;
  border-radius: 6px;
  border: none;
  background: #CF7F72; /* アクセントカラー */
  color: #fff;
  font-weight: bold;
  cursor: pointer;
}

/* カテゴリ */
.category {
  margin-bottom: 30px;
}

.category-title {
  font-size: 20px;
  font-weight: bold;
  margin-bottom: 10px;
  color: #482019;
}

.items-row {
  display: flex;
  overflow-x: auto;
  gap: 12px;
  padding-bottom: 10px;
}

.inventory-item {
  position: relative;
  width: 180px;
}

.item-button {
  width: 100%;
  padding: 12px;
  border-radius: 12px;
  background: #F7CFC0;
  border: 1px solid #CF7F72;
  text-align: left;
  min-height: 120px;
  transition: color 0.3s, background 0.3s;
}

.item-button.out-of-stock {
  color: #999;
  background: #EBD7D2;
}

.item-name {
  font-size: 18px;
  font-weight: bold;
  color: #482019;
}

.small-text {
  font-size: 12px;
  color: #6B3A2B;
}

.circle-buttons {
  position: absolute;
  bottom: 6px;
  right: 6px;
  display: flex;
  gap: 6px;
}

.circle-buttons button {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  border: none;
  background: #CF7F72;
  color: #fff;
  font-size: 20px;
  cursor: pointer;
  font-weight: bold;
}
</style>
</head>
<body>

<h1>在庫管理</h1>

<!-- 追加フォーム -->
<div class="add-form">
  <label>分類：</label>
  <select id="category-select"></select>

  <label>アイテム名：</label>
  <input type="text" id="item-name-input" placeholder="例：バター">

  <button onclick="addItem()">追加</button>
</div>

<div id="inventory-container"></div>

<script>
// -----------------------------
// 日付を M/D に変換
// -----------------------------
function formatMD(dateStr) {
  if (!dateStr || dateStr === "未設定") return "未設定";
  const d = new Date(dateStr);
  return `${d.getMonth() + 1}/${d.getDate()}`;
}

// -----------------------------
// 初期カテゴリ（デフォルト）
// -----------------------------
const defaultCategories = [
  { name: "調味料（冷蔵庫）", items: ["醤油", "酒", "みりん", "めんつゆ", "オイスターソース", "味噌", "しょうが", "にんにく"] },
  { name: "調味料", items: ["醤油（卓上）", "ナンプラー", "砂糖", "塩", "片栗粉", "コンソメブロック", "コンソメ顆粒", "鶏ガラ", "ごま", "すりごま"] },
  { name: "粉類", items: ["小麦粉", "強力粉", "米粉", "パン粉"] },
  { name: "麺", items: ["パスタ", "そば", "うどん", "そうめん", "ひやむぎ"] },
  { name: "缶詰", items: ["ツナ", "コーン", "さば", "あずき"] }
];

// -----------------------------
// 保存データの読み込み
// -----------------------------
let inventoryCategories = JSON.parse(localStorage.getItem("inventoryCategories") || "[]");
let inventoryData = JSON.parse(localStorage.getItem("inventoryData") || "{}");

// -----------------------------
// 初期データと保存データをマージ
// -----------------------------
defaultCategories.forEach(defCat => {
  let savedCat = inventoryCategories.find(c => c.name === defCat.name);

  if (!savedCat) {
    inventoryCategories.push({ name: defCat.name, items: [...defCat.items] });
    savedCat = inventoryCategories.find(c => c.name === defCat.name);
  } else {
    defCat.items.forEach(item => {
      if (!savedCat.items.includes(item)) {
        savedCat.items.push(item);
      }
    });
  }

  defCat.items.forEach(item => {
    if (!inventoryData[item]) {
      inventoryData[item] = {
        name: item,
        currentDate: "未設定",
        stock: 0,
        stockDates: []
      };
    }
  });
});

// -----------------------------
// 分類セレクト作成
// -----------------------------
function setupCategorySelect() {
  const select = document.getElementById("category-select");
  select.innerHTML = "";
  inventoryCategories.forEach(cat => {
    const option = document.createElement("option");
    option.value = cat.name;
    option.textContent = cat.name;
    select.appendChild(option);
  });
}
setupCategorySelect();

// -----------------------------
// アイテム追加
// -----------------------------
function addItem() {
  const categoryName = document.getElementById("category-select").value;
  const itemName = document.getElementById("item-name-input").value.trim();

  if (!itemName) return alert("アイテム名を入力してください");
  if (inventoryData[itemName]) return alert("このアイテムはすでに存在します");

  const category = inventoryCategories.find(c => c.name === categoryName);
  category.items.push(itemName);

  inventoryData[itemName] = {
    name: itemName,
    currentDate: "未設定",
    stock: 0,
    stockDates: []
  };

  document.getElementById("item-name-input").value = "";

  saveData();
  renderInventory();
}

// -----------------------------
// 保存
// -----------------------------
function saveData() {
  localStorage.setItem("inventoryCategories", JSON.stringify(inventoryCategories));
  localStorage.setItem("inventoryData", JSON.stringify(inventoryData));
}

// -----------------------------
// 描画
// -----------------------------
function renderInventory() {
  const container = document.getElementById("inventory-container");
  container.innerHTML = "";

  inventoryCategories.forEach(category => {
    const catDiv = document.createElement("div");
    catDiv.className = "category";

    const title = document.createElement("div");
    title.className = "category-title";
    title.textContent = category.name;

    const row = document.createElement("div");
    row.className = "items-row";

    category.items.forEach(itemName => {
      const item = inventoryData[itemName];

      const wrapper = document.createElement("div");
      wrapper.className = "inventory-item";

      const button = document.createElement("button");
      button.className = "item-button";
      if (item.stock === 0) button.classList.add("out-of-stock");

      button.innerHTML = `
        <div class="item-name">${item.name}</div>
        <span class="small-text">交換日: ${formatMD(item.currentDate)}</span><br>
        <span class="small-text">在庫: ${item.stock}</span><br>
        ${
          item.stock > 0
            ? `<span class="small-text">購入日: ${formatMD(item.stockDates[item.stockDates.length - 1])}</span>`
            : ""
        }
      `;

      const circle = document.createElement("div");
      circle.className = "circle-buttons";

      const plus = document.createElement("button");
      plus.textContent = "+";
      plus.onclick = () => {
        const today = new Date().toISOString().split("T")[0];
        item.stock++;
        item.stockDates.push(today);
        saveData();
        renderInventory();
      };

      const minus = document.createElement("button");
      minus.textContent = "-";
      minus.onclick = () => {
        if (item.stock > 0) {
          item.currentDate = item.stockDates.pop();
          item.stock--;
        }
        saveData();
        renderInventory();
      };

      circle.appendChild(plus);
      circle.appendChild(minus);

      wrapper.appendChild(button);
      wrapper.appendChild(circle);
      row.appendChild(wrapper);
    });

    catDiv.appendChild(title);
    catDiv.appendChild(row);
    container.appendChild(catDiv);
  });
}

renderInventory();
</script>

</body>
</html>